\section{Data samples}
\label{ref:sel:data}

This analysis currently uses 1665~pb$^{-1}$ of proton-proton collision data
recorded by LHCb in 2016 at $\sqrt{s} = 13$~TeV.
It is planned to extend the analysis to employ data taken in the full
2016--2018 period (run 2).
The rest of the section describes selection procedures for various data samples,
which are:

\begin{itemize}
    \item \nameref{ref:sel:data:rs}:
        the nominal data samples to be fitted.
    \item \nameref{ref:sel:data:ws}:
        for characterizing various combinatorial backgrounds,
        constituting random combinations of \DXmu pairs that are \emph{not}
        originating from the same $B$ decay but passes the selection cuts
        requiring so.
    \item \nameref{ref:sel:data:fake-mu}:
        for studying the contributions from other charged particles
        mis-identified as muon in the nominal data sample.
\end{itemize}


\subsection{Right-sign samples}
\label{ref:sel:data:rs}

These are the data samples used in the fit where the signal and normalization
yields are extracted.
The samples contain right-sign \DXmu pairs,
the pairs that have the correct charges to form a legitimate $B$ meson.
That is, only \Dz\mun and \Dstarp\mun (and their charge conjugates).
The \muon in these samples are required to pass \muon particle identification
(PID) requirements.

The online selection for the \Dz\mun and \Dstarp\mun final states,
henceforth referred as \Dz channel and \Dstar channel,
are identical.
The selection involves an online trigger path:
a composition of hardware (L0) and software triggers (HLT1, HLT2),
as listed in \cref{tab:triggers}.
Overall, the online selection requires a \muon candidate to form
a well-defined vertex
with a high $p_T$ $\Dz (\rightarrow \Km \pip)$ candidate,
requiring both particles to be close to each other and are not directly coming
from the primary $pp$ decay vertex (PV).
More details about the trigger path are given below.


\begin{table}[!htb]
    \caption{
        Trigger path for this analysis.
        For terminologies such as TIS and TOS, refer to
        \cref{appx:trigger-cat}.
    }
    \label{tab:triggers}
    \centering
    \parnotereset
    \begin{tabular}{c|c}
        \toprule
        {\bf Trigger level} & {\bf Requirements} \\
        \midrule
        L0 & \Dz L0Hadron TOS || \B L0Global TIS \\
        HLT1 & \makecell{
            (\kaon~\smalltt{Hlt1TrackMVA} TOS || \pion~\smalltt{Hlt1TrackMVA} TOS)\parnote{
                This is almost equivalent to \Dz~\smalltt{Hlt1TrackMVA} TOS, with a
                $\sim\!0.0027\%$ difference in selected events in
                reconstructed data sample in \Dz channel.
                Henceforth these two trigger paths are considered equivalent.
            } || \\ \Dz~\smalltt{Hlt1TwoTrackMVA} TOS
        } \\
        HLT2 & \B~\smalltt{Hlt2XcMuXForTauB2XcMu} TOS \\
        \bottomrule
    \end{tabular}
    \begin{flushleft}
        \parnotes
    \end{flushleft}
\end{table}


%%%%
The L0 triggers are chosen to make sure events are not trigged by
the \muon track \emph{alone} which would introduce a \pt bias\footnote{
    According to table 1 in \cite{LHCb-DP-2019-001},
    the minimum \pt threshold across all L0 triggers is 1.35 GeV for 2018
    L0Muon trigger.
} on the \muon.
Such a bias is very problematic for this analysis as \muon from signal
$\tauon \rightarrow \muon \neumb \neut$ decays are typically softer and
have smaller \pt,
making signal events less likely to be selected.
A muon trigger would,
as discussed at the end of \cref{ref:detector},
actively reject signal decays as well as making the selection efficiencies for
the signal and normalization decay modes different.
%%%%
The inclusive HLT1 triggers select events containing a particle whose decay
vertex is displaced from the PV,
in this case a $\Dz \rightarrow \Km \pip$,
as described in \cite{LHCb-INT-2019-025}, Section 6.7.1.
%%%%
The \smalltt{Hlt2XcMuXForTauB2XcMu} is specifically designed for this analysis
to select \Dz\mupm candidates\footnote{
    Yes, both right-sign and wrong-signs of the \Dz\muon pairs are selected.
} with a high \pt requirement on \Dz,
while maintain minimal \pt bias on the \mupm.
%%%%
The trigger avoid cut on the invariant mass of the \Dz\muon pair
so that both the right-sign and wrong-sign samples can be selected with the same
trigger path:
the right-sign \Dz\muon pairs are more likely to form a \Dstar meson,
producing a peak around the mass of \Dstar,
whereas the wrong-sign \Dz\muon pairs are dominated by random combinations thus
not peaking.
The cuts imposed by the HLT2 line are listed in \cref{tab:cut-hlt2}.


\begin{table}[!htb]
    \caption{Cuts defined in \smalltt{Hlt2XcMuXForTauB2XcMu}.}
    \label{tab:cut-hlt2}
    \centering
    \begin{tabular}{ c | rll}
        \toprule
        {\bf Particle} & {\bf Variable}               & {\bf Cuts}               \\
        \midrule
        \kaon, \pion   & \pt                          & $> 200$ MeV              \\
                       & Max \pt                      & $> 800$ MeV              \\
                       & \ptot                        & $> 5$ GeV                \\
                       & \ipChiSq                     & $> 9$                    \\
                       & \PID{$K$}                    & $> 2\;(K)$, $< 4\;(\pi)$ \\
        \midrule
        \Dz            & \pt                          & $> 2000$ MeV             \\
                       & $|\pi\;\pt|+|K\;\pt|$        & $> 2.5$ GeV              \\
                       & $m$                          & 1830--1910 MeV           \\
                       & \anyChiSq{vertex}/ndf        & $< 10$                   \\
                       & \anyChiSq{FD}                & $> 25$                   \\
                       & \DIRA                        & $> 0.999$                \\
                       & Child pair \DOCA             & $< 0.1$ mm               \\

        \midrule
        \muon          & \ipChiSq                     & $> 16$                   \\

        \midrule
        \Dz\muon       & \anyChiSq{vertex}/ndf        & $< 15$                   \\
                       & \anyChiSq{FD}                & $> 50$                   \\
                       & \DIRA                        & $> 0.999$                \\
                       & \DOCA                        & $< 0.5$ mm               \\
        \bottomrule
    \end{tabular}
\end{table}


Additional offline selections with stricter vertex quality and PID requirements
are applied to both \Dz and \Dstar channels.
%%%%
Furthermore, only the right-sign $D^{(*)}\mu$ candidates are kept.
%%%%
The offline selections that are shared among \Dz and \Dstar channels are listed
in \cref{tab:cut-stripping,tab:offline-cut-common}.
The additional \Dz only cuts are listed in \cref{tab:offline-cut-d0},
the \Dstar in \cref{tab:offline-cut-dst}.

Due to the fact that the \Dz and \Dstar channel have the same online selection,
some events will appear in both,
making the two channels correlated.
%%%%
This correlation is removed by a \Dstar veto procedure in the \Dz channel,
and is discussed in \cref{ref:sel:tech:veto}.

Previous analyses (\cite{PhysRevLett.115.111803,LHCb-ANA-2020-056})
showed that a tighter \muon PID reduces other charged species misidentified
(misID) as \muon, reducing the systematic uncertainty due to misID effects.
However, the standard LHCb \muon PID has low efficiency at low \pt.
Therefore, an offline \muon PID method, termed \UBDT, is developed to reduce
misID while maintain a flat \pt response.
A brief overview on this method is provided in \cref{ref:sel:tech:ubdt}.


\begin{table}[!htb]
    \caption{Base offline selections (stripping) for both \Dz and \Dstar channels.}
    \label{tab:cut-stripping}
    \centering
    \begin{tabular}{c|rll}
        \toprule
        {\bf Event-Level }      & {\bf Variable}               & {\bf Cuts}               \\
        \midrule
        GEC                     & nSPDhits                     & $< 600$                  \\
        PV cut                  & nPV                          & $\geq1$                  \\
        \toprule
        {\bf Particle }         & {\bf Variable}               & {\bf Cuts}               \\
        \midrule
        $K, \pi$                & \pt                          & $> 300$ MeV              \\
                                & \ptot                        & $> 2$ GeV                \\
                                & \anyChiSq{IP}                & $> 9$                    \\
                                & \isMuon                      & \texttt{False}           \\
                                & \PID{$K$}                    & $> 4\;(K)$, $< 2\;(\pi)$ \\
                                & GhostProb                    & $< 0.5$                  \\
        \midrule
        \Dz                     & $|\pi\;\pt|+|K\;\pt|$        & $> 2.5$ GeV              \\
                                & $m - m_\text{PDG}$           & $< 80$ MeV               \\
                                & \anyChiSq{vertex}/nof        & $< 4$                    \\
                                & \anyChiSq{FD}                & $> 25$                   \\
                                & \DIRA                        & $> 0.999$                \\
        \midrule
        \muon                   & \ptot                        & $> 3$ GeV               \\
                                & \ipChiSq                     & $> 16$                  \\
                                & isMuon                       & \texttt{True}           \\
                                & \PID{$\mu$}                  & $> -200$                \\
                                & GhostProb                    & $< 0.5$                 \\
        \midrule
        \Dz\muon                & $m$                          & 0--10 GeV               \\
                                & \anyChiSq{vertex}/ndf        & $< 6$                   \\
                                & \DIRA                        & $>0.999$                \\
        \bottomrule
    \end{tabular}
\end{table}


\begin{table}[!htb]
    \caption{Additional offline selections shared among \Dz and \Dstar channels.}
    \label{tab:offline-cut-common}
    \centering
    \begin{tabular}{c|rll}
        \toprule
        {\bf Event-Level }  & {\bf Variable}               & {\bf Cuts}               \\
        \midrule
        GEC                 & nSPDhits                     & $< 450$\parnote{
            This is to reduce correlation for \emph{TIS and TOS} candidates to make
            trigger emulation more robust.
            See \cref{ref:mc-emulation:correlation-tos-tis} for more details.
        }                                                                             \\
        \toprule
        {\bf Particle}      & {\bf Variable}               & {\bf Cuts}               \\
        \midrule
        $K, \pi$            & \pt                          & $> 500$ MeV              \\
                            & HLT1 TOS track \pt           & $> 1.7$ GeV              \\
                            & \ptot                        & $< 200$ GeV\parnote{
                                This is to make \ptot consistent with extended
                                \pidcalib binning.
                            }                                                         \\
                            & \anyChiSq{IP}                & $> 45$                   \\
                            & \isMuon                      & \texttt{False}           \\
                            & \PID{$K$}                    & $> 4\;(K)$, $< 2\;(\pi)$ \\
                            & GhostProb                    & $< 0.5$                  \\
        \midrule
        \Dz                 & \pt                          & $> 2$ GeV                \\
                            & $|\pi\;\pt|+|K\;\pt|$        & $> 1.4$ GeV              \\
                            & $\log(\IP)$\parnote{
                                \IP in terms of the \PrmVtx.
                                That is, the reconstructed \Dz is inconsistent
                                of coming from \PrmVtx directly.
                            }                              & $> -3.5$                 \\
                            & \anyChiSq{IP}                & $> 9$                    \\
                            & \anyChiSq{vertex}/ndf        & $< 4$                    \\
                            & \anyChiSq{FD}                & $> 250$                  \\
                            & \DIRA                        & $> 0.9998$               \\
        \midrule
        \muon               & \ptot                        & 3-100 GeV                \\
                            & $\log_{10}(1 - \vec{p}_\mu \cdot \vec{p}_i / (|p_\mu||p_i|))$,
                              $i \in \{K, \pi\}$
                                                           & $> -6.5$                 \\
                            & $\eta$                       & 1.7--5                   \\
                            & \ipChiSq                     & $> 45$                   \\
                            & GhostProb                    & $< 0.5$                  \\
                            & \PID{$\mu$}                  & $> 2$                    \\
                            & \PID{$e$}                    & $< 1$                    \\
                            & \UBDT\parnote{
                                This is a BDT-based \muon PID algorithm,
                                which is discussed in \cref{ref:sel:tech:ubdt}.
                            }
                                                           & $> 0.25$                 \\
        \bottomrule
    \end{tabular}
    \begin{flushleft}
        \parnotes
    \end{flushleft}
\end{table}


\begin{table}[!htb]
    \caption{Offline cuts exclusive to \Dz channel.}
    \label{tab:offline-cut-d0}
    \centering
    \begin{tabular}{c|rll}
        \toprule
        {\bf Particle}  & {\bf Variable}               & {\bf Cuts}      \\
        \midrule
        \Dz\muon        & $m$                          & $< 5200$ MeV\parnote{
            The odd-looking 5200 is to avoid a peak around 5280 due to misID
            in \Bm mass spectrum.
            For \Bzb, the misID peak around 5280 is insignificant, so the cut
            is placed at 5280, at which value the neutrino is produced
            \emph{at rest in $B$ frame}, which covers a small phase space.
        }    \\
                        & {\footnotesize$\begin{aligned}
                                \text{Max}(
                                    &|\Delta m_\text{veto,1} - 145.454|, \\
                                    &|\Delta m_\text{veto,2} - 145.454|
                                )
                           \end{aligned}$}\parnote{
                            \label{parnote:dst-veto}
                            To reduce overlapping events between
                            \Dz and \Dstar channels.
                            Discussed in \cref{ref:sel:tech:veto}.
                        }                              & $> 4$ MeV       \\
                        & $\Delta m_\text{alt hypo}$\parnoteref{parnote:dst-veto}
                                                       & $> 165$ MeV     \\
                        & transverse flight distance   & $< 7$ mm        \\
                        & \anyChiSq{vertex}/ndf        & $< 6$           \\
                        & \DIRA                        & $> 0.9995$      \\
        \bottomrule
    \end{tabular}
    \begin{flushleft}
        \parnotes
    \end{flushleft}
\end{table}


\begin{table}[!htb]
    \caption{Offline cuts exclusive to \Dstar channel.}
    \label{tab:offline-cut-dst}
    \centering
    \begin{tabular}{c|rll}
        \toprule
        {\bf Particle}  & {\bf Variable}                 & {\bf Cuts}    \\
        \midrule
        slow \pion     & GhostProb                       & $< 0.25$      \\
        \midrule
        \Dstarp        & $|m - m_\Dz - 145.454|$\parnote{
                           This is to require $m_\Dstarp$ to close to
                           its reference (PDG) mass,
                           up to a reconstruction effect on
                           $m_\Dz$.
                       }                                 & $< 2$ MeV     \\
                       & \anyChiSq{vertex}/ndf           & $< 10$        \\
        \midrule
        \Dz\muon       & \anyChiSq{vertex}/ndf           & $< 6$         \\
                       & \DIRA                           & $> 0.999$     \\
        \midrule
        \Dstarp\muon   & $m$                             & $< 5280$ MeV  \\
                       & transverse flight distance      & $< 7$ mm      \\
                       & \anyChiSq{vertex}/ndf           & $< 6$         \\
                       & \anyChiSq{vertex}               & $< 24$        \\
                       & \DIRA                           & $> 0.9995$    \\
        \bottomrule
    \end{tabular}
    \begin{flushleft}
        \parnotes
    \end{flushleft}
\end{table}


\subsection{Wrong-sign samples}
\label{ref:sel:data:ws}

The wrong sign samples are used to model combinatorial backgrounds which are
most dominate in the $D^{(*)}\mu$ pairs,
as only one-sided mass cut is applied on them, as opposed to a two-sided
mass window cut
(e.g. $m < 5280$ instead of $5280 - \epsilon < m < 5280 + \epsilon$).
Due to the presence of missing neutrino(s), the $B$ meson 4-momentum is not
fully reconstructed.
Therefore,
the invariant mass of $D^{(*)}\mu$ pairs might be far away from the known $B$
meson mass and \emph{no suitable} mass window cut can be applied.
For \Dz channel, the \emph{unphysical}\footnote{
    Recall that the right-sign sample are reconstructed as the following decay:
    $\Bm \rightarrow \Dz (\rightarrow \Km \pip) \mun$,
    so \Dz\mup pairs are unphysical.
} \Dz\mup pairs are purely of combinatorial
nature and is the only dominate combinatorial;
this is referred as \BComb.
For \Dstar channel, a \Dstarp may randomly combine with a
\emph{wrong-sign \mup} (\BComb); alternatively, a \Dz may combine with a
\emph{wrong-sign slow \pim} to form a \Dstarm (\DstComb).
The modeling of these backgrounds are discussed in
\cref{ref:fit:tmpl:comb}.

The online selection for wrong sign samples are the same as the right sign,
as described in \cref{ref:sel:data:rs}.
The offline selection is also mostly identical, with differences listed below:

\begin{itemize}
    \item \Dz channel, wrong-sign \muon (\BComb):
        The wrong-sign \Dz\mup candidates are used in place of the right-sign
        \Dz\mun.
    \item \Dstar channel, wrong-sign \muon (\BComb):
        The wrong-sign \Dz\mup candidates are used.
    \item \Dstar channel, wrong-sign \pion (\DstComb):
        The right-sign \Dz\mun candidates are used.
        Furthermore, a wrong-sign slow \pim is selected so the \Dz\pim pair
        forms a wrong-sign \Dstarm.
\end{itemize}


\subsection{Fake muon samples}
\label{ref:sel:data:fake-mu}

The fake \muon samples are used to estimate the misidentification of a charged
particle to a \muon.
Both right-sign and wrong-sign misID samples share the same selections
as the respective ``real'' \muon sample,
except for \muon PID which is replaced by an explicit \muon veto
(not \isMuon).
Also, only 10\% of event passing the fake \muon online selection are stored.
The contribution due to \muon misID is studied in \cref{ref:fit:tmpl:misid}.
