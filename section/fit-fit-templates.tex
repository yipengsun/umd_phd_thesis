\section{Fit templates}
\label{ref:fit:tmpl}

This selection describes generation of fit templates,
followed by comments on the characteristics of the templates and the
normalization factors controlling the yields of the templates.
There are a total of 37 templates in \Dz channel and 24 in \Dstar channel,
with some templates generated with the decays that contribute to both
channels.
For a brief overview of the templates,
\cref{tab:fit-templates-d0,tab:fit-templates-dst} may be used.
The normalization factors for the signal fit are summarized in
\cref{tab:fit-norm-fact-d0,tab:fit-norm-fact-dst} for the \Dz and \Dstar channel
accordingly and will be documented in the next subsections.
These normalization factors are color-coded as:
\begin{itemize}
    \item \textbf{\textcolor{black}{black}}:
        an unconstrained factor,
        implemented with a \HistFactory\ \smalltt{NormFactor}.
    \item \textbf{\textcolor{red}{red}}:
        a fixed factor,
        also implemented with the \smalltt{NormFactor}.
    \item \textbf{\textcolor{blue}{blue}}:
        a factor with a Gaussian constraint
        where the nominal value is 1 and the standard deviation $\sigma$.
        The fitter reports the \emph{variation} of the factor with an $\alpha$
        parameter such that when the underlying parameter is at 1,
        the associated $\alpha = 0$;
        when the underlying parameter is at $1 \pm \sigma$, the $\alpha = \pm 1$.
        Implemented with a \HistFactory\ \smalltt{OverallSys}.
    \item \textbf{\textcolor{magenta}{magenta}}:
        a fixed \smalltt{OverallSys} factor.
        Typically such a factor is \emph{constrained} in the control fit and
        loaded as a \emph{fixed} factor in the signal fit.
\end{itemize}


\input{fit-tab-template-overview.tex}


The data-driven templates,
namely \muon misID and combinatorial background templates,
are discussed first in \cref{ref:fit:tmpl:misid,ref:fit:tmpl:comb}.
They are used to estimate both the shapes and the yields of the misID and
combinatorial backgrounds.

The rest are all MC templates which can be categorized into signal,
normalization, feed downs from \Dstst/heavy \Dstst/$D^{**}_s$, and contributions
from $DDX$ decay modes.
Only the shapes of these templates are taken as the shapes of the fit variables
of these decays.
All categories share the same selection requirement as discussed in
\cref{ref:sel:mc}.
Additional global weights to account for emulation of trigger and PID
(\cref{ref:mc-emulation}),
form factor reweighting (\cref{ref:mc-cor:ff}, whenever applicable),
and corrections to detector responses (\cref{ref:mc-cor:init,ref:mc-cor:final})
are also applied according to \cref{eqn:mc-wts},
with weight-capping strategy specified as:

\begin{equation}
    w_\text{tot} = \underbrace{\left(
            w_\text{trigger} \cdot w_\text{PID} \cdot
            \overbrace{
                w_\text{tracking} \cdot w_{\jpsi\kaon}
            }^\text{initial weight}
        \right)}_\text{capped at 10} \;\; \times
        \underbrace{w_\text{form factor}}_{\substack{
            \text{capped at} \\
            \text{50 for \Dz and \Dstar} \\
            \text{10 for $D^{**}$}
        }} \times \;\;
        \underbrace{
            {\textstyle\prod_i} w_\text{final weight,step $i$}
        }_\text{capped at 10}
        \label{eqn:mc-wts}
\end{equation}


\subsection{Muon misID backgrounds}
\label{ref:fit:tmpl:misid}

The \muon misID templates,
shown in \cref{fig:misid-vs-sig},
representing contributions from non-\muon tracks passing the \muon
identification requirements in ``real'' \muon samples,
are generated from the fake \muon control sample
(as in \cref{ref:sel:data:fake-mu}) with an unfolding technique.
First conceived in \cite{LHCb-ANA-2016-059}, the unfolding technique
consists of the following steps:

\begin{figure}[!htb]
    \centering
    \begin{subfigure}{0.9\textwidth}
        \centering
        \caption{
            \muon misID vs. $\Bm \rightarrow \Dz\taum\neutb$ in \Dz channel.
        }
    \end{subfigure}

    \begin{subfigure}{0.9\textwidth}
        \centering
        \caption{
            \muon misID vs. $\Bzb \rightarrow \Dstarp\taum\neutb$ in \Dstar channel.
        }
    \end{subfigure}

    \caption{
        Comparison between misID and the signal templates in their
        respective channel.
    }
    \label{fig:misid-vs-sig}
\end{figure}

\begin{enumerate}
    \item Tag the fake \muon sample into $\pi$, $K$, $p$,
        $e$, and ghost\footnote{
            ``Ghost'' refers to tracks formed by random combination of hits.
        }-like species with the selection requirements listed in
        \cref{tab:selection-for-tagged-species}.
        Denote tagged species with a hat:
        $\hat{t} \in \{\hat{\pi}, \hat{K}, \hat{p}, \hat{e}, \hat{g}\}$,

    \item Obtain the efficiency for a track of true species $t$ passing \muon
        acceptance to be classified as a tagged species $\hat{t}'$
        (where $t$ and $t'$ can be the same species, e.g. a true electron
        (passing \muon acceptance) classified as a tagged electron):
        $\misEff[t]{\hat{t}'}$.
        These efficiencies are obtained from \pidcalib for $\pi, K, p, e$ and
        from MC for $g$.

    \item Given the measured yields in the fake \muon sample $\tilde{n}_{\hat{t}'}
        $ and response matrix
        $M_{\hat{t}', t^{\phantom{}}} = \misEff[t^{\phantom{}}]{\hat{t}'}$,
        % NOTE: The subscript of M is indeed tag, true!!! NOT true, tag!!!
        unfold the true yields $\tilde{n}_{t}$.
        A Bayesian unfolding (iterative unfolding, \cite{DAGOSTINI1995487})
        algorithm is used to obtain the true yields and subsequently the
        efficiencies of a tagged
        $\hat{t}'$ being a true $t$: $\misEff[\hat{t}']{t}$.

      \item Find $\misEff[\hat{t}']{\hat{\mu}}$,
        the transfer factor from the fake \muon sample
        (of tagged species $\hat{t}'$) to the ``real'' \muon
        samples\footnote{
            A subtlety is that here ``real'' \muon refers to the samples passing
            \muon PID cuts listed in \cref{ref:sel:data:rs}.
            Because the \muon-like particles are selected by a set of cuts,
            a hat is placed on \muon ($\hat{\mu}$!)
            to remind the reader that this sample is nothing but a \muon tag
            and is unrelated to the \muon-enriched sample (true \muon) as used
            by \pidcalib.
        },
        based on
        \begin{itemize}
            \item the efficiencies obtained in the step above,
            \item the efficiency of a track of true species $t$ that falls
                within \muon acceptance to also pass the \muon PID cuts
                $\misEff[t_\text{acc}]{\hat{\mu}}$,
            \item and the efficiency of $t_\text{acc}$ to \emph{fail} the \muon
                PID:
                $\misEff[t_\text{acc}]{t}$.
        \end{itemize}

        \begin{equation}
            \misEff[\hat{t}']{\hat{\mu}} =
                \sum_{t}
                \frac{\misEff[\hat{t}']{t}}{\misEff[t_\text{acc}]{t}}
                \misEff[t_\text{acc}]{\hat{\mu}}
        \end{equation}
        The last two efficiencies are found from \pidcalib.

    \item Apply $\misEff[\hat{t}']{\hat{\mu}}$ as a weight for each
        tagged species $\hat{t}'$ in the fake \muon sample.
        The weighted yield of tagged species $\hat{t}$ represents the \muon misID
        contributions of $\hat{t}$ to the ``real'' \muon samples.
\end{enumerate}

Comparisons between tagged and unfolded (true) yields of the fake \muon sample
are shown in \cref{fig:unfolding-binning-vars}.
The weighted yields are projected in fit variables with finer binning;
these are shown in \cref{fig:unfolding-fit-vars}.
Some of the efficiencies obtained with \pidcalib are negative; these are shifted
back to a value between $[0, 1]$ with an algorithm described in
\cref{appx:formal:shift-neg-eff}.
A more detailed description of the unfolding procedure is documented in
\cref{appx:unfold-tech}.

% Generated in /misid-unfolding, with the command
%   make plot-rdx-bin_vars-ana-2016
\begin{figure}[!htb]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-tag_p.pdf}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-tag_eta.pdf}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-tag_ntracks.pdf}
    \end{subfigure}
    \\
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-true_p.pdf}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-true_eta.pdf}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0-true_ntracks.pdf}
    \end{subfigure}
    \caption[misID tagged vs. unfolded.]{
        Unfolding effect displayed in $p$ and $\eta$ of the fake $\mu$ track,
        and nTracks of the reconstructed event.
        Top are the raw tagged yields,
        bottom are the unfolded true yields.
        The number of events is conserved by unfolding.

        The samples displayed here are 2016 $D^0$ fake \muon control samples
        $B^- \rightarrow D^0 t^-$ passing selections listed in
        \cref{ref:sel:data:fake-mu}.
    }
    \label{fig:unfolding-binning-vars}
\end{figure}

% Generated in /lhcb-ntuples-gen/studies/plot-RDX_misid_unfold_fit_vars, by
% running the script gen.sh inside
\begin{figure}[!htb]
    \centering
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0_mm2.pdf}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0_el}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.32\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/misid/D0_q2.pdf}
    \end{subfigure}
    \caption[Weighted yields of fake \muon sample.]{
        The weighted yields of each species of fake \muon sample projected in
        fit variables.
        The dominate contributions to the ``real'' muon samples are from
        \pion-like and ghost-like tracks.
        The binning are finer compared to \cref{fig:misid-vs-sig}. Actual
        yields are displayed without any rescaling.
    }
    \label{fig:unfolding-fit-vars}
\end{figure}

\begin{table}[!htb]
    \centering
    \caption{Selections for each tagged species in fake \muon sample.}
    \label{tab:selection-for-tagged-species}
    \begin{tabular}{crl}
        \toprule
        {\bf Tagged species} & {\bf Variable}            & {\bf Selection} \\
        \midrule
        $\pi$                & \ProbNN{\pion}            & $> 0.1$   \\
                             & \PID{\kaon}               & $< 0.0$   \\
                             & \PID{$p$}                 & $< 0.0$   \\
                             & \PID{$e$}                 & $< 2.0$   \\
                             & \ProbNN{ghost}            & $< 0.25$  \\
        \midrule
        $K$                  & \ProbNN{\kaon}            & $> 0.1$   \\
                             & \PID{\kaon}               & $> 0.0$   \\
                             & \PID{$p$} $-$ \PID{\kaon} & $< 0.0$   \\
                             & \PID{$e$} $-$ \PID{\kaon} & $< -2.0$  \\
                             & \ProbNN{ghost}            & $< 0.25$  \\
        \midrule
        $p$                  & \ProbNN{$p$}              & $> 0.1$   \\
                             & \PID{$p$}                 & $> 0.0$   \\
                             & \PID{$p$} $-$ \PID{\kaon} & $> 2.0$   \\
                             & \PID{$e$} $-$ \PID{$p$}   & $< -2.0$  \\
                             & \ProbNN{ghost}            & $< 0.25$  \\
        \midrule
        $e$                  & \PID{$e$}                 & $> 2.0$   \\
                             & \PID{$e$} $-$ \PID{\kaon} & $> -2.0$  \\
                             & \PID{$e$} $-$ \PID{$p$}   & $> -2.0$  \\
                             & \ProbNN{ghost}            & $< 0.25$  \\
        \midrule
        ghost                & Not in any species above  & \\
        \bottomrule
    \end{tabular}
\end{table}


\subsection{Combinatorial backgrounds}
\label{ref:fit:tmpl:comb}

The selection procedures for all combinatorial backgrounds are listed
in \cref{ref:sel:data:ws}.
The generation procedure for these templates is documented below.
A comparison between combinatorial backgrounds and signal templates is
shown in \cref{fig:comb-vs-sig}.

% TODO: Implement comb. bkg. tmpl. comparison
\begin{figure}[!htb]
    \centering
    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \caption{
            \BComb and \DstComb vs. $\Bm \rightarrow \Dz\taum\neutb$ in \Dz channel.
        }
    \end{subfigure}

    \begin{subfigure}[t]{0.9\textwidth}
        \centering
        \caption{
            \BComb vs. $\Bzb \rightarrow \Dstarp\taum\neutb$ in \Dstar channel.
        }
    \end{subfigure}

    \caption{
        Comparison between combinatorial backgrounds and signal template.
    }
    \label{fig:comb-vs-sig}
\end{figure}

\subsubsection{$D^*$ combinatorial}
\label{dst-comb}

The $D^*$ combinatorial background (\DstComb) arises from a reconstructed $D^0$
combining with an random slow $\pi$, forming a fake $D^*$ vertex and
passing all selection requirements.

The shape of \DstComb can be determined from wrong-sign $\pi$ (WS $\pi$) control
sample which contains mostly $D^0 \pi^-$ pairs.
Still, the yields of \DstComb between nominal right-sign (RS) sample and
WS $\pi$ are not the same,
likely due to differences in selection efficiencies.
Thus a fit on the RS sample is performed to obtain
the yield of \DstComb, then the WS $\pi$ is rescaled to match the fitted yield.
The fit procedure is the following:

\begin{enumerate}
    \item Remove misID contribution from RS sample.
    \item Remove misID contribution from WS $\pi$ sample\footnote{
            A WS $\pi$ control sample from misID sample is reconstructed to
            obtain the misID contribution for data WS $\pi$.
        }.
    \item Fit the mass window $m_{D^*} - m_{D^0}$ (including events normally
        outside the window) on RS sample with a
        double-Gaussian signal and an exponential background.
        The background yield under the mass window where a $D^*$ is nominally
        accepted is taken as the yield of \DstComb.

        The fit to ISO skim is shown in \cref{fig:dst-comb-fit}.
        The effect of scaling for the ISO skim is shown in
        \cref{fig:dst-comb-scale}.
        For fit to 1OS, 2OS, and DD skims, refer to \cref{appx:suppl:dst-comb}.
\end{enumerate}

\techlink{appx:tech:fit-to-comb-bkg}

% Generated in /rdx-run2-analysis/fit with the command:
%   make fit-DstComb
\begin{figure}[!htb]
    \centering
    \includegraphics[width=\textwidth]{figs-fit-fit-templates/data-driven-plots/dst_comb/fit_dst_comb_iso_comb.pdf}
    \caption{
        \DstComb\ auxiliary fit to the ISO skim.
        Right plot shows the same fit as in the left, but with a logarithmic $y$
        axis.
    }
    \label{fig:dst-comb-fit}
\end{figure}

\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.55\textwidth]{figs-fit-fit-templates/data-driven-plots/dst_comb/fit_dst_comb_scaled_comp_iso_log.pdf}
    \caption{
        Effect of scaling for the ISO skim on the \DstComb\ template.
    }
    \label{fig:dst-comb-scale}
\end{figure}

\subsubsection{$B$ combinatorial in $D^*$ channel}
\label{b-comb-dst}

The $B$ combinatorial (\BComb) in $D^*$ fit channel comes from randomly
combined $D^* \mu$ pairs.
Again, the shape of the \BComb\ is determined by wrong-sign $\mu$ (WS $\mu$)
control sample containing $D^{*+} \mu^+$ pairs.

Further, it is assumed that the \BComb\ from WS $\mu$ and \BComb\ from RS
differs by a factor linear in $m_B$.
This is justified by assuming \BComb\ are slow-varying exponential decays in
terms of $m_B$ for both RS and WS $\mu$, thus the ratio between the two is also
an exponential.
Since they are slow-varying, Taylor expansion to the first order (i.e. of the
form $a + b m_B$) agrees well with the ratio in a sufficiently large region.

Unlike $m_\Dstar$ in \DstComb,
$m_B$ does not have a clear lower side-band.
This is because \B is only \emph{partially} reconstructed
due to missing neutrino(s).
Therefore, only the upper-sideband, defined as $m_B > 5400$ MeV,
which contains purely combinatorial and misID, can be used to
study \BComb.

A fit is performed in $B$ mass upper-sideband  to obtain
the linear scaling factor $a + b m_B$.
In the upper-sideband, it is assumed that both WS $\mu$ and RS samples contain
are pure, that is, containing only combinatorial backgrounds and misID.
The linear scaling factor is assumed to be the same for all skims\footnote{
    This is mainly because there is not enough number of events in the
    upper-sideband to perform fits skim-by-skim.
}.
The fit is performed in the following manner:

\begin{enumerate}
    \item Remove misID contribution from RS sample.
    \item Remove misID contribution from WS $\mu$ sample.
    \item Perform a fit on RS sample in the upper-sideband region to determine
        contribution from \DstComb, with procedure identical to that in
        \cref{dst-comb}.
        Then remove the fitted \DstComb.
    \item Fit and remove \DstComb\ from WS $\mu$ sample.
    \item Compute the ratio between RS and WS $\mu$, perform a fit to obtain
        the linear scaling factor.
        The fit,
        as well as the raw RS, raw WS \muon, and scaled WS \muon templates,
        is shown in \cref{fig:b-comb-dst}.
\end{enumerate}

% FIXME: Replace quad. fit w/ an exp. fit
% Generated in /rdx-run2-analysis/fit with the command:
%   make fit-BCombDst
\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.48\textwidth]{figs-fit-fit-templates/data-driven-plots/b_comb/fit_b_comb_dst_fit.pdf}
    \includegraphics[width=0.48\textwidth]{figs-fit-fit-templates/data-driven-plots/b_comb/fit_b_comb_dst_scaled.pdf}

    \caption[\BComb\ fit result for $D^*$ channel]{
        \BComb\ fit result for $D^*$ channel.

        Left: \BComb\ auxiliary fit in the $m_B$ upper-sideband region for all skims.
        A quadratic fit is also performed for possible systematic studies.

        Right: The scaling effect on the WS $\mu$ \BComb\ template.
    }
    \label{fig:b-comb-dst}
\end{figure}

\subsubsection{$B$ combinatorial in $D^0$ channel}
\label{b-comb-d0}

The procedure is similar to that in \cref{b-comb-dst}, but without \DstComb\
removal. The fit is shown in \cref{fig:b-comb-d0}.

% FIXME: Replace quad. fit w/ an exp. fit
% Generated in /rdx-run2-analysis/fit with the command:
%   make fit-BCombD0
\begin{figure}[!htb]
    \centering
    \includegraphics[width=0.48\textwidth]{figs-fit-fit-templates/data-driven-plots/b_comb/fit_b_comb_d0_fit.pdf}
    \includegraphics[width=0.48\textwidth]{figs-fit-fit-templates/data-driven-plots/b_comb/fit_b_comb_d0_scaled.pdf}

    \caption{
        \BComb\ fit result for $D^*$ channel.
        Left: \BComb\ auxiliary fit.
        Right: The scaling effect on the WS $\mu$ \BComb\ template.
    }
    \label{fig:b-comb-d0}
\end{figure}


\subsection{Normalization}
\label{tmpl:norm}

\paragraph{$B \rightarrow D^{0,*+}\mun\neumb$}
The yields of these two decay modes,
denoted as \fitNDmu and \fitNmu,
are set to be the free-floating overall normalization for all MC templates of
the respective fit channel.
As a side note,
the \Dz\muon template has notably softer \qSq spectrum compared to
that of \Dstarp\muon,
as shown in \cref{fig:d0-norm-vs-dst-norm}.

The \Dstarp\muon mode also contributes to the \Dz channel due to feed down,
with its yield normalized by:
\begin{equation}
    \fitNDmu \times \left\{
        \fitDstISO \times \fitnormfd
    \right\}
\end{equation}
where \fitDstISO is the relative yield ratio between the \Dstarp\muon and
\Dstarz\muon samples:
\begin{equation}
    \fitDstISO =
    \left.\frac{
        \epsilon(\Bzb \rightarrow \Dstarp\mun\neumb)
    }{
        \epsilon(\Bm \rightarrow \Dstarz\mun\neumb)
    }\right|_\text{initial value from MC}^\text{floating in the fit}\times
    \frac{
        \mathcal{B}(\Bzb \rightarrow \Dstarp\mun\neumb)
    }{
        \mathcal{B}(\Bm \rightarrow \Dstarz\mun\neumb)
    }
\end{equation}
where the first ratio, a selection efficiency ratio,
with its initial value obtained with MC samples satisfying the \Dz channel
selection criteria,
is not unity due to different isolation efficiencies for charged
\Dstarp and neutral \Dstarz decays;
the second ratio is the branching fraction ratio attained from external
measurements.
The other parameter \fitnormfd is the yield ratio between the \Dstarz\muon and
\Dz\muon samples\footnote{
    With the convention that a superscript ``$0/*$'' indicates
    it is a parameter in the \Dz/\Dstar channel.
}:
\begin{equation}
    \fitnormfd =
    \left.\frac{
        \epsilon(\Bm \rightarrow \Dstarz\mun\neumb)
    }{
        \epsilon(\Bm \rightarrow \Dz\mun\neumb)
    }\right|_\text{initially set to 1}^\text{floating in the fit} \times
    \frac{
        \mathcal{B}(\Bm \rightarrow \Dstarz\mun\neumb)
    }{
        \mathcal{B}(\Bm \rightarrow \Dz\mun\neumb)
    }
\end{equation}

%%%%
\paragraph{$B \rightarrow D^{*0}\mun\neumb$}
This mode contributes to the \Dz channel exclusively due to feed down.
Its yield is constrained by
\begin{equation}
    N_{D\mu} \times \fitnormfd
\end{equation}
A comparison between this template and the signal template in the \Dz
channel is also shown in \cref{fig:d0-norm-vs-dst-norm}.

%%%%
\begin{figure}[!htb]
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D0Mu__vs__D0_iso_DstMu__vs__D0_iso_Dst0Mu__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D0Mu__vs__D0_iso_DstMu__vs__D0_iso_Dst0Mu__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D0Mu__vs__D0_iso_DstMu__vs__D0_iso_Dst0Mu__q2.pdf}
        \caption{
            $\textcolor{red}{\Bm \rightarrow \Dz\mun\neumb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \Dstarp\mun\neumb}$ feed down
            vs
            $\textcolor{gray}{\Bm \rightarrow \Dstarz\mun\neumb}$ feed down.
            All in \Dz channel.
            The signal template
            $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$
            in the \Dz channel is included as a reference.
        }
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DstMu__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DstMu__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DstMu__q2.pdf}
        \caption{
            $\textcolor{orange}{\Bzb \rightarrow \Dstarp\mun\neumb}$ vs
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$,
            both in \Dstar channel.
        }
    \end{subfigure}

    \caption{
        Comparisons between normalization templates.
    }
    \label{fig:d0-norm-vs-dst-norm}
\end{figure}


\subsection{Signal}
\label{tmpl:sig}

\paragraph{$\Bm \rightarrow \Dz\taum\neutb$}
Its yield is related to $N_{D\mu}$ by the following expression:
\begin{equation}
    N_{D\mu} \times \left\{
        \RD \times \underbrace{
            \BRTauToMu \times
            \frac{
                \epsilon{(\Bm \rightarrow \Dz \taum [\rightarrow \mun\neumb\neut] \neutb)}
            }{
                \epsilon({\Bm \rightarrow \Dz \mun \neumb})
            }
        }_{\equiv \fitRDEff}
    \right\}
\end{equation}
where $\RD \equiv \RDz$ is the free-floating parameter of interest,
and \fitRDEff is the (\tauon leptonic exclusive) efficiency ratio between the
signal and the normalization mode in the \Dz channel,
with the efficiencies obtained with the corresponding MC samples satisfying
the \Dz\muon selection criteria.

%
\paragraph{$B \rightarrow \Dstarp\taum\neutb$}
This signal mode contributes to both channels due to feed down.
In the \Dstar channel, its normalization is given by:
\begin{equation}
    \fitNmu \times \left\{
        \RDst \times \underbrace{
            \BRTauToMu \times \frac{
                \epsilon{(\Bzb \rightarrow \Dstarp \taum [\rightarrow \mun\neumb\neut] \neutb)}_{\Dstar}
            }{
                \epsilon{(\Bzb \rightarrow \Dstarp \mun\neumb)}_{\Dstar}
            }
        }_{\equiv \fitRDstEff}
    \right\}
\end{equation}
where $\RDst \equiv \RDstp$ is the other parameter of interest,
and \fitRDstEff is the efficiency ratio between the signal and the normalization
in the \Dstar channel,
with the tilde emphasizing that the efficiencies are evaluated with the
\Dstarp\muon selection cuts.

Its \Dz channel feed down yield can be formally written as
\begin{align}
    \fitNDmu \times & \Bigg\{
        \overbrace{
            \frac{
                \mathcal{B}(\Bzb \rightarrow \Dstarp \mun\neumb)
            }{
                \mathcal{B}(\Bm \rightarrow \Dz \mun\neumb)
            } \times \frac{
                \epsilon(\Bzb \rightarrow \Dstarp \mun\neumb)
            }{
                \epsilon(\Bm \rightarrow \Dz \mun\neumb)
        }}^{\equiv \fitDstISO \times \fitnormfd} \times
    \nonumber \\
        & \hphantom{\Bigg\{} \underbrace{\BRTauToMu \times \frac{
            \epsilon(\Bzb \rightarrow \Dstarp \taum [\rightarrow \mun\neumb\neut] \neutb)
        }{
            \epsilon(\Bzb \rightarrow \Dstarp \mun\neumb)
        }}_{\equiv \eta_{\Dstarp}\text{, which is not \fitRDstEff!}}
        \times \RDst \Bigg\}
\end{align}
which can then be rewritten as
\begin{equation}
    N_{\Dz\muon} \times \left\{
        \RDst \times \fitRdDstEffFactor \times \fitRDstEff \times \fitDstISO \times \fitnormfd
    \right\}
\end{equation}
noting that $\eta_{\Dstarp}$ is the efficiency ratio evaluated at the \Dz
channel (also notice the lack of a tilde!) and the \BRTauToMu\ cancels in the
second parameter inside the bracket above which is a ratio.

\paragraph{$\Bm \rightarrow \Dstarz\taum\neutb$}
Only contributing in the \Dz channel, its yield is given by:
\begin{equation}
    N_{\Dz\muon} \times \left\{
        \RDst \times \fitRuDstEffFactor \times \fitRDstEff \times \fitnormfd
    \right\}
\end{equation}
where $\eta_{\Dstarz}$ is defined similarly to $\eta_{\Dstarp}$.

The four efficiency ratios
$\fitRDEff, \fitRDstEff, \eta_{\Dstarp}, \eta_{\Dstarz}$
are all fixed in the fit so that \emph{no} correction to these ratios is
derived due to concerns about the sensitivity to these parameters.
Comparisons between the signal templates are shown in
\cref{fig:d0-sig-vs-dst-sig}.

%%%%
\begin{figure}[!htb]
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DstTau__vs__D0_iso_Dst0Tau__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DstTau__vs__D0_iso_Dst0Tau__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DstTau__vs__D0_iso_Dst0Tau__q2.pdf}

        \caption{
            $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$
            vs
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$ feed down
            vs
            $\textcolor{red}{\Bm \rightarrow \Dstarz\taum\neutb}$ feed down.
        }
        \label{fig:d0-sig-vs-d0-norm}
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__Dst_iso_DstTau__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__Dst_iso_DstTau__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__Dst_iso_DstTau__q2.pdf}

        \caption{
            $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$
            in \Dz channel
            vs
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$
            in \Dstar channel.
        }
    \end{subfigure}
    \caption{Comparisons between the signal templates.}
    \label{fig:d0-sig-vs-dst-sig}
\end{figure}


\subsection{Feed down through $B \rightarrow D^{**}\ellm\neulb$ modes}
\label{tmpl:dstst}

The fit includes the following feed-down templates from four $1P$ $D^{**}$
states $D_0^*(2300)$, $D'_1(2430)$, $D_1(2420)$, $D_2^*(2460)$,
including both isospin pairs for each \Dstst,
with the subscript indicating the total angular momentum $J$ of the
meson\footnote{
    Note that for $S = 1$ and $L = 1$, the allowed values for $J$ are
    $2, 1, 0$.
    That is, $1 \oplus 1 = 2 \otimes 1 \otimes 0$.
}:

\begin{itemize}
    \item \textbf{\Dz channel}:
        All four states contribute.
        Additionally, the $D_1$ states are reported to have the cascade decays
        $D_1 \rightarrow D_0^* (\rightarrow \Dz \pi) \pi$ observed;
        events with such decay modes are put into the
        $D_1 \rightarrow (\Dz \pi\pi)$ templates,
        abbreviated as $D_1 \pi\pi$.
        The $D_0^*$ is assumed to contribute exclusively to this channel due
        to conservation of angular momentum.

        Therefore, for the \Dz channel,
        there are $(4+1) \times 2$ muonic templates where the factor 2 comes
        from the isospin doublet (e.g. $D_0^{*0}$ and $D_0^{*+}$)
        and $(4+1) \times 2$ tauonic ones for a total of 20 \Dstst templates.

    \item \textbf{\Dstar channel}:
        Only the $J = 1,2$ states contribute.
        Also, no cascade decay of the form
        $D^{**} \rightarrow D^{**} (\rightarrow \Dstar \pi) \pi$ is considered.
        For this channel,
        there are $3 \times 2$ muonic templates
        and $3 \times 2$ tauonic ones for a total of 12 \Dstst templates.
\end{itemize}

%%%%
\paragraph{Muonic}
The normalization factor of a \Dstst ``species'' $i$ in the \Dz channel is given
by
\begin{equation}
    \Omega_{\Dstst}^0 \equiv \fitNDmu \times \left\{
        \fitisoDi \times \fitNDststDz \times \fitBFDDi \times
        \text{expected fraction $\Dstst_i/\Dstst$}
    \right\}
    \label{eqn:dstst-yield-d0}
\end{equation}
where the allowed species are $D_0^*, D'_1, D_1, D_1\pi\pi, D_2^*$
(both isospins), and
\begin{itemize}
    \item \fitisoDi is a Gaussian isospin constraint initially set to 1
        with a $\sigma = 0.5$.
    \item $\fitNDststDz \equiv \frac{10^{-3}}{\mathcal{B}(\Bm \rightarrow \Dz\mun\neumb)}$
        is a shared convenience factor so that the floating \fitBFDDi can be
        interpreted as the branching fraction of $\Dstst_i$ multiplied by its
        selection efficiency.
        \fitBFDDi is initially set around 1.
    \item ``$\text{expected fraction $\Dstst_i/\Dstst$}$'' is different
        for \Bm and \Bzb modes:

    \begin{itemize}
        \item \textbf{\Bm modes}:
            contains a single parameter \fitfDDi defined as
            \begin{equation}
                \fitfDDi = \mathcal{B}(\Bm \rightarrow \Dstst_i) \times
                \frac{
                    \epsilon(\Bm \rightarrow \Dstst\mu)_\text{avg}
                }{
                    \epsilon(\Bm \rightarrow \Dz\mu)_\text{avg}
                }
            \end{equation}
            where the branching fraction is computed by accounting for the
            relevant $B \rightarrow \Dstst \rightarrow D$ and
            $B \rightarrow \Dstst \rightarrow \Dstar \rightarrow D$ decay chains,
            assuming
            $\mathcal{B}(\Dstarz \rightarrow \Dz X) \approx 100\%$ and
            $\mathcal{B}(\Dstarp \rightarrow \Dz X) \approx 67\%$.
            Currently, these values are taken from the run 1 pathfinder analysis
            \cite{LHCb-ANA-2020-056}.

        \item \textbf{\Bzb modes}:
            contains two parameters $\fitfDDi \times \epsilon_{\Dstst_i}$,
            where the second parameter is an efficiency ratio, defined as
            \begin{equation}
                \epsilon_{\Dstst_i} =
                \frac{
                    \epsilon(\Bzb \rightarrow \Dstst_i\mu)
                }{
                    \epsilon(\Bm \rightarrow \Dstst\mu)_\text{avg}
                }
            \end{equation}
    \end{itemize}
\end{itemize}

In the \Dstar channel, the normalization of $\Dstst_i$ is:
\begin{equation}
    \Omega_{\Dstst}^* \equiv \fitNmu \times \left\{
        \underbrace{\fitBFDi \times \fitBFDstpi}_\text{two Gaussian constraints}
        \times \fitNDststz \times
        \text{expected fraction $\Dstst_i/\Dstst$}
    \right\}
    \label{eqn:dstst-yield-dst}
\end{equation}
where the allowed species are $D'_1, D_1, D_2^*$.
The Gaussian systematic uncertainties on the branching fraction multiplied by
(selection) isolation efficiency is split into two parameters:
the correlated \fitBFDstpi and the uncorrelated \fitBFDi.
The shared convenience factor \fitNDststz is defined similar to \fitNDststDz,
with the branching fraction replaced by
$\mathcal{B}(\Bzb \rightarrow \Dstarz \mun\neumb)$.
Again, the ``expected fraction $\Dstst_i/\Dstst$'' is different between \Bm
and \Bzb modes:
\begin{itemize}
    \item \textbf{\Bm modes}:
        consists of two parameters:
        \begin{equation}
            \underbrace{
                \mathcal{B}(\Bm \rightarrow \Dstst_i) \times
                \frac{\epsilon(\Bm \rightarrow \Dstst\mu)_\text{avg}}{
                    \epsilon(\Bzb \rightarrow \Dstst\mu)_\text{avg}
                }
            }_{\equiv \fitfDi}
            \times \fitisolationsys
        \end{equation}
        where \fitisolationsys is an additional systematic uncertainty on
        isolation efficiency because these modes are expected to have larger
        yields.

    \item \textbf{\Bzb modes}:
        consists of two parameters:
        \begin{equation}
            \underbrace{\mathcal{B}(\Bzb \rightarrow \Dstst_i)}_{\equiv \fitfDi}
            \times \frac{1}{2}
        \end{equation}
        where the second parameter comes from isospin relation
        $\mathcal{B}(\Dstst \rightarrow \Dstarp\pim) /
        \mathcal{B}(\Dstst \rightarrow \Dstarz\piz) = 1/2$.
\end{itemize}

The $D^{**}$ muonic decays often contain unreconstructed \piz or $\gamma$ which
leads to a broad \mmSq distribution peaking at smaller values
$\approx m^2_\pion$,
as shown in \cref{fig:dstst-mu}.
The \el spectrum is comparable, but typically softer, than that in normalization,
due to $D^{**}$ states having higher masses compared to \Dz and \Dstar.
These decays are suppressed at zero recoil,
but translates weakly in the reconstructed \qSq spectrum,
due to rest frame approximation (\cref{appx:rfa}) and definition of \qSq being
$(p_B - p_{D^{(*)}})^2$, instead of $(p_B - p_{D^{**}})^2$
\cite{LHCb-ANA-2020-056}.

\begin{figure}[!htb]
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststMu__vs__D0_iso_D1ststMuD0PiPi__vs__D0_iso_D0ststMu__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststMu__vs__D0_iso_D1ststMuD0PiPi__vs__D0_iso_D0ststMu__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststMu__vs__D0_iso_D1ststMuD0PiPi__vs__D0_iso_D0ststMu__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_1^+\mun\neumb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \D_1^+ (\rightarrow \Dz\pi\pi) \mun\neumb}$
            vs
            $\textcolor{gray}{\Bzb \rightarrow \D_0^{*+}\mun\neumb}$.
            All in \Dz channel.
            The $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$ is plotted
            as a reference.
        }
    \end{subfigure}

    % \begin{subfigure}{\textwidth}
    %     \centering
    %     \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1stst0Mu__vs__D0_iso_D1stst0MuD0PiPi__vs__D0_iso_D0stst0Mu__m2miss.pdf}
    %     \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1stst0Mu__vs__D0_iso_D1stst0MuD0PiPi__vs__D0_iso_D0stst0Mu__el.pdf}
    %     \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1stst0Mu__vs__D0_iso_D1stst0MuD0PiPi__vs__D0_iso_D0stst0Mu__q2.pdf}
    %     \caption{
    %         $\textcolor{red}{\Bm \rightarrow \D_1^0\mun\neumb}$
    %         vs
    %         $\textcolor{orange}{\Bm \rightarrow \D_1^0 (\rightarrow \Dz\pi\pi) \mun\neumb}$
    %         vs
    %         $\textcolor{gray}{\Bm \rightarrow \D_0^{*0}\mun\neumb}$
    %         vs reference
    %         $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$.
    %     }
    % \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststMu__vs__Dst_iso_D1pststMu__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststMu__vs__Dst_iso_D1pststMu__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststMu__vs__Dst_iso_D1pststMu__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_1^+\mun\neumb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \D_1^{'+} \mun\neumb}$
            vs reference
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$.
            All in \Dstar channel.
        }
    \end{subfigure}

    \caption{Comparison between muonic \Dstst templates.}
    \label{fig:dstst-mu}
\end{figure}

%
\paragraph{Tauonic}
As in run 1, the yields of  tauonic $D^{**}$ decays are constrained as a
fraction to their muonic counterparts individually.
In both channels, the yield with a loose 33\% constraint is given by
\begin{equation}
    \Omega \times \fitRDststRaw \times \fitRDiRatio \times \left[
        \underbrace{\text{\fitRDDstst for \Dz chan, \fitRDstst for \Dstar chan}}_\text{
            a Gaussian constraint with a $\sigma = 0.33$
        }
    \right]
\end{equation}
where $\Omega$ refers to \cref{eqn:dstst-yield-d0} for \Dz channel,
and \cref{eqn:dstst-yield-dst} for \Dstar channel.
The \fitRDststRaw is based on the average between $\mathcal{R}(\Dstst_i)$,
taken to be $\mathcal{R}(\Dstst)_\text{avg} = 0.12$ which is the value used in
the run 1 analysis,
while also absorbing selection efficiencies.
Each
$\fitRDiRatio \equiv \frac{\mathcal{R}(\Dstst_i)}{\mathcal{R}(\Dstst)_\text{avg}}$
is also taken from the previous analysis.
Displayed in \ref{fig:dstst-tau},
the tauonic \Dstst templates have harder \mmSq and \qSq spectra compared to the
signal templates.

\begin{figure}[!htb]
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststTau__vs__D0_iso_D1ststTauD0PiPi__vs__D0_iso_D0ststTau__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststTau__vs__D0_iso_D1ststTauD0PiPi__vs__D0_iso_D0ststTau__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_D1ststTau__vs__D0_iso_D1ststTauD0PiPi__vs__D0_iso_D0ststTau__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_1^+\taum\neutb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \D_1^+ (\rightarrow \Dz\pi\pi) \taum\neutb}$
            vs
            $\textcolor{gray}{\Bzb \rightarrow \D_0^{*+}\taum\neutb}$.
            All in \Dz channel.
            The $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$ is plotted
            as a reference.
        }
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststTau__vs__Dst_iso_D1pststTau__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststTau__vs__Dst_iso_D1pststTau__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_D1ststTau__vs__Dst_iso_D1pststTau__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_1^+\taum\neutb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \D_1^{'+} \taum\neutb}$
            vs reference
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$.
            All in \Dstar channel.
        }
    \end{subfigure}

    \caption{Comparison between tauonic \Dstst templates.}
    \label{fig:dstst-tau}
\end{figure}


\subsection{Feed down through $B \rightarrow D_H^{**}(\rightarrow D^{(*)}\pi\pi)\mun\neumb$ modes}

The heavy $D_H^{**}$ decay into either a \Dz or a \Dstar, with two additional
\pion, one of them possibly uncharged.
The \Dstarp events contribute to both channels while the \Dstarz only to the \Dz
channel.
These decay modes are not well measured, and a cocktail MC is used so that
the relative fractions between the $D_H^{**}$ are fixed at simulation level.
More details regarding the composition of the cocktail can be found in
\cite{LHCb-ANA-2020-056}.
The yield of $D_H^{**} \rightarrow D_i$, essentially unconstrained, is defined
similarly for both channels:
\begin{equation}
    N_\text{ch ref} \times \left\{
        n_\text{scale} \times f_{D_i}
        \underbrace{(\times f_\text{guess})}_\text{
            only present in \Dz channel. A fixed parameter.
        }
    \right\}
\end{equation}
where $D_i$ can be a \Dz, a \Dstarz, or a \Dstarp.
Depend on the context,
$N_\text{ch ref} = \fitNDmu \text{ or } \fitNmu$ and
$n_\text{scale} = \fitNDststDz \text{ or } \fitNDststz$.
The parameter $f_\text{guess}$, exclusive to the \Dz channel, is a guess.
The $D_H^{**}\mu$ templates are plotted in
\cref{fig:dstst-heavy}.

\begin{figure}[!htb]
    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DststHMuDst__vs__D0_iso_DststHMuDst0__vs__D0_iso_DststHMuD0__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DststHMuDst__vs__D0_iso_DststHMuDst0__vs__D0_iso_DststHMuD0__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/D0_iso_D0Tau__vs__D0_iso_DststHMuDst__vs__D0_iso_DststHMuDst0__vs__D0_iso_DststHMuD0__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_H^{**} (\rightarrow \Dstarp\pi\pi) \taum\neutb}$
            vs
            $\textcolor{orange}{\Bzb \rightarrow \D_H^{**} (\rightarrow \Dstarz\pi\pi) \taum\neutb}$
            vs
            $\textcolor{gray}{\Bzb \rightarrow \D_H^{**} (\rightarrow \Dz\pi\pi) \taum\neutb}$.
            All in \Dz channel.
            The $\textcolor{blue}{\Bm \rightarrow \Dz\taum\neutb}$ is plotted
            as a reference.
        }
    \end{subfigure}

    \begin{subfigure}{\textwidth}
        \centering
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DststHMuDst__m2miss.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DststHMuDst__el.pdf}
        \includegraphics[width=0.3\textwidth]{figs-fit-fit-templates/histo-comp/Dst_iso_DstTau__vs__Dst_iso_DststHMuDst__q2.pdf}
        \caption{
            $\textcolor{red}{\Bzb \rightarrow \D_H^{**} (\rightarrow \Dstarp\pi\pi) \taum\neutb}$
            vs reference
            $\textcolor{magenta}{\Bzb \rightarrow \Dstarp\taum\neutb}$.
            Both in \Dstar channel.
        }
    \end{subfigure}

    \caption{Comparison between $D_H^{**}\mu$ and \Dz\taum signal templates.}
    \label{fig:dstst-heavy}
\end{figure}


\subsection{Feed down through $\Bsb \rightarrow \DststS\mun\neumb$ modes}

The contributions from the semileptonic \Bsb decays are accounted for via
the $\Bsb \rightarrow D_{s1}^{'+} (\rightarrow (\Dstarp\Kz|\Dstarz\Kp))\mun$ and
$\Bsb \rightarrow D_{s2}^{*+} (\rightarrow (\Dstarp\Kz|\Dstarz\Kp|\Dz\Kp))\mu$
decays.
The \Dstarp\Kz\mun modes contribute to both channels whereas the
rest to the \Dz channel only.
With two templates for each fit channel,
the \Dz channel templates are cocktails.
The yields in the \Dz channel are constrained separately for each
${\DststS}_i$ species:
\begin{equation}
    \fitNDmu \times \left\{
        \fitfsfd \times \fitNDststDz \times \mathcal{B}_{{\DststS}_i} \times
        N_{{\DststS}_i}
    \right\}
\end{equation}
where $\fitfsfd = 2.6$ (the latest measured value is 2.4 at 13~TeV) accounts for
the production ratio between \Bzb and \Bsb mesons,
$\mathcal{B}_{{\DststS}_i}$ is a Gaussian constraint with a 40\% uncertainty,
and $N_{{\DststS}_i}$ is the expected yield based on measured branching fractions
and selection efficiencies from MC.

The \Dstar channel yields for both templates are constrained within 24\%
of the expected yield of $D_{s1}^{'+}\mun$,
with an additional factor $\fitftwofonep = 0.3$ to account for the relative
yields for the $D_{s2}^{*+}$ template.

A comparison between the $D_s^{**}$ templates and \Dz\taum signal can be
seen at \cref{fig:d_s-vs-d0-sig}.

\begin{figure}[!htb]
    %\begin{subfigure}{\textwidth}
    %    \caption{
    %        $\Bm \rightarrow \Dz\taum\neutb$ vs.
    %        $\Bzb \rightarrow \Dstarp\taum\neutb$.
    %    }
    %    \label{fig:d0-sig-vs-dst-sig}
    %\end{subfigure}

    \caption{Comparison between $D_s^{**}\mu$ and \Dz\taum signal templates.}
    \label{fig:d_s-vs-d0-sig}
\end{figure}


\subsection{Double-charm ($DDX$) backgrounds}
\label{ref:fit:tmpl:ddx}

The double-charm backgrounds include contributions from
$B \rightarrow D^{(*)}(\rightarrow \mun\neumb)\bar{D}^{(*)} X$ decays, where $X$
is either a \kaon, a \Kstar, or a higher \Kstar resonance.
The $DDX$ are poorly understood as these MC are generated with
a phase space model so generated events are distributed evenly in the available
phase space, without taking the resonance structure,
which itself is not precisely known for $n \geq 3$-body decays,
of the Dalitz plane into account.
Additionally, the $D \rightarrow X \ell\neulb$ decay form factors are
parameterized with the quark-model of ISGW2,
which is known to unable describe data sufficiently well\footnote{
    As commented in \cite{LHCb-ANA-2020-056}:
    ``In the current literature it is found that single-pole-dominance provides
    a much better description of the data than quark-model calculations.''
}.
More details regarding the variations will be discussed in
\cref{ref:fit:var:ddx}.
Both muonic and tauonic $DDX$ templates are similar to the signal templates,
as can be seen in \cref{fig:ddx-vs-d0-sig}.
This is due to the fact that a large portion of energy is taken by the
unreconstructed $D$ meson.

\begin{figure}[!htb]
    %\begin{subfigure}{\textwidth}
    %    \caption{
    %        $\Bm \rightarrow \Dz\taum\neutb$ vs.
    %        $\Bzb \rightarrow \Dstarp\taum\neutb$.
    %    }
    %    \label{fig:d0-sig-vs-dst-sig}
    %\end{subfigure}

    \caption{Comparison between $DDX$ and \Dz\taum signal templates.}
    \label{fig:ddx-vs-d0-sig}
\end{figure}


The relative fractions for the muonic modes are fixed from known branching
fractions at MC generation level.
There is an additional degree of freedom on relative yields between \Bm and \Bzb
with a Gaussian constrain.
Similar to $1P$ $D^{**}$ tauonic modes,
the $DDX$ tauonic modes are constrained near the relative branching fractions
(\tauon vs. \muon) with a 30\% Gaussian variation,
without any degree of freedom on relative yields between \Bm and \Bzb.


\input{fit-tab-norm-factors.tex}
